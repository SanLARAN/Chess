<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–®–∞—Ö–º–∞—Ç—ã —Å –ö–∞—Ä—Ç–∞–º–∏</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard.js/1.0.0/css/chessboard.min.css">
  <style>
    body {
      font-family: sans-serif;
      background: #eee;
      text-align: center;
      padding: 20px;
    }
    #board {
      width: 400px;
      margin: 0 auto;
    }
    #status {
      font-weight: bold;
      margin: 10px;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
    }
    .hand {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .card {
      border: 2px solid #333;
      background: #fff;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      width: 120px;
    }
  </style>
</head>
<body>

  <h2>‚ôüÔ∏è –®–∞—Ö–º–∞—Ç—ã —Å –ö–∞—Ä—Ç–∞–º–∏</h2>
  <div id="board"></div>
  <p id="status">–•–æ–¥ –±–µ–ª—ã—Ö</p>
  <button onclick="drawCard()">–í–∑—è—Ç—å –∫–∞—Ä—Ç—É</button>

  <div class="hand" id="hand"></div>

  <!-- –°–∫—Ä–∏–ø—Ç—ã chess.js –∏ chessboard.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.12.0/chess.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard.js/1.0.0/js/chessboard.min.js"></script>

  <script>
    const game = new Chess();
    let currentTurn = 'w';
    let extraMove = false;

    const playerState = {
      hand: [],
      frozenPieces: {}
    };

    const cardPool = [
      {
        id: "freeze",
        name: "‚ùÑ –ó–∞–º–æ—Ä–æ–∑–∫–∞",
        description: "–ó–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç –≤—Ä–∞–∂–µ—Å–∫—É—é —Ñ–∏–≥—É—Ä—É –Ω–∞ 1 —Ö–æ–¥.",
        effect: (targetSquare) => {
          playerState.frozenPieces[targetSquare] = 1;
          alert(`–§–∏–≥—É—Ä–∞ –Ω–∞ ${targetSquare} –∑–∞–º–æ—Ä–æ–∂–µ–Ω–∞!`);
        }
      },
      {
        id: "teleport",
        name: "üåÄ –¢–µ–ª–µ–ø–æ—Ä—Ç",
        description: "–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ —Å–≤–æ—é —Ñ–∏–≥—É—Ä—É –Ω–∞ —Å–≤–æ–±–æ–¥–Ω—É—é –∫–ª–µ—Ç–∫—É.",
        effect: (from, to) => {
          const piece = game.get(from);
          if (!piece || piece.color !== currentTurn) {
            alert("–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é —Ñ–∏–≥—É—Ä—É.");
            return;
          }
          if (game.get(to)) {
            alert("–ö–ª–µ—Ç–∫–∞ –∑–∞–Ω—è—Ç–∞.");
            return;
          }
          game.remove(from);
          game.put(piece, to);
          board.position(game.fen());
        }
      },
      {
        id: "double_move",
        name: "‚ö° –î–≤–æ–π–Ω–æ–π —Ö–æ–¥",
        description: "–°–¥–µ–ª–∞–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–æ–¥.",
        effect: () => {
          extraMove = true;
          alert("–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!");
        }
      }
    ];

    const board = Chessboard('board', {
      draggable: true,
      position: 'start',
      onDrop: onDrop
    });

    function onDrop(source, target) {
      if (playerState.frozenPieces[source]) {
        alert("–≠—Ç–∞ —Ñ–∏–≥—É—Ä–∞ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–∞.");
        return 'snapback';
      }

      const move = game.move({ from: source, to: target, promotion: 'q' });
      if (move === null) return 'snapback';

      updateStatus();

      if (!extraMove) switchTurn();
      else extraMove = false;

      board.position(game.fen());
    }

    function switchTurn() {
      currentTurn = currentTurn === 'w' ? 'b' : 'w';

      for (const square in playerState.frozenPieces) {
        playerState.frozenPieces[square]--;
        if (playerState.frozenPieces[square] <= 0)
          delete playerState.frozenPieces[square];
      }

      updateStatus();
    }

    function updateStatus() {
      const status = document.getElementById("status");
      if (game.game_over()) {
        status.textContent = "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.";
      } else {
        status.textContent = `–•–æ–¥ ${currentTurn === 'w' ? '–±–µ–ª—ã—Ö' : '—á—ë—Ä–Ω—ã—Ö'}`;
      }
    }

    function drawCard() {
      const card = JSON.parse(JSON.stringify(cardPool[Math.floor(Math.random() * cardPool.length)]));
      playerState.hand.push(card);
      renderHand();
    }

    function renderHand() {
      const hand = document.getElementById("hand");
      hand.innerHTML = "";
      playerState.hand.forEach((card, index) => {
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `<b>${card.name}</b><br><small>${card.description}</small>`;
        el.onclick = () => useCard(index);
        hand.appendChild(el);
      });
    }

    function useCard(index) {
      const card = playerState.hand[index];
      if (!card) return;

      if (card.id === "freeze") {
        const sq = prompt("–ö–ª–µ—Ç–∫–∞ –≤—Ä–∞–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: e7):");
        if (sq) card.effect(sq);
      }

      if (card.id === "teleport") {
        const from = prompt("–û—Ç–∫—É–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: b1):");
        const to = prompt("–ö—É–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: c3):");
        if (from && to) card.effect(from, to);
      }

      if (card.id === "double_move") {
        card.effect();
      }

      playerState.hand.splice(index, 1);
      renderHand();
    }

    updateStatus();
  </script>
</body>
</html>
