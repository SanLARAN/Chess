<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chess Alko</title>

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- Telegram Login Widget -->
  <script async src="https://telegram.org/js/telegram-widget.js?15" data-telegram-login="YOUR_BOT_USERNAME" data-size="large" data-userpic="true" data-lang="ru" data-on-auth="onTelegramAuth(user)" data-request-access="write"></script>

  <!-- Chessboard.js & Chess.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"></script>

  <style>
    body { margin: 0; font-family: 'Arial', sans-serif; background-color: #081b4c; color: white; }
    .header { background-color: #123b93; display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; }
    .logo { font-size: 24px; font-weight: bold; }
    .logo span { color: #44aaff; }
    .profile { display: flex; align-items: center; gap: 10px; }
    .profile img { width: 32px; height: 32px; border-radius: 50%; background: white; }
    .main { display: flex; padding: 20px; gap: 20px; }
    .history, .leaderboard { background-color: #0b2464; padding: 20px; border-radius: 16px; width: 300px; max-height: 400px; overflow-y: auto; }
    .match, .leaderboard-entry { background-color: #0f2f7a; border-radius: 12px; padding: 10px; margin-bottom: 10px; }
    .match img { width: 50px; height: auto; float: right; }
    .footer { position: absolute; bottom: 20px; right: 20px; text-align: right; }
    .search-btn, .login-btn { background: #0b4ac0; border: none; padding: 15px 30px; font-size: 24px; color: white; border-radius: 16px; cursor: pointer; margin-top: 10px; }
    .rating { font-size: 14px; margin-bottom: 5px; }
    .rating span { color: #44aaff; }
    #board { width: 400px; margin: 20px auto; display: none; }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">Chess<span>`alko</span></div>
    <div class="profile">
      <button id="login-btn" class="login-btn">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram</button>
      <div id="profile-name">–ì–æ—Å—Ç—å</div>
      <img id="profile-pic" src="https://via.placeholder.com/32" alt="avatar" />
    </div>
  </div>

  <div class="main" id="main-container">
    <div class="history">
      <h2>–ò—Å—Ç–æ—Ä–∏—è <span style="color: #44aaff; font-size: 16px"><span id="mmr">1000</span> mmr</span></h2>
      <!-- –ü—Ä–∏–º–µ—Ä –º–∞—Ç—á–µ–π (–º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏) -->
      <div class="match">
        <strong>–ú–∞—Ç—á 1</strong> <span style="color: #00ff99;">+15</span> –ü–æ–±–µ–¥–∞
        <br><span id="profile-name-history">Nick</span> <b>vs</b> NickPro <img src="/mnt/data/12.png" alt="board" />
      </div>
      <!-- ... -->
    </div>

    <div class="leaderboard">
      <h2>–¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h2>
      <div class="leaderboard-entry">ü•á Alice ‚Äî 1450 –º–º—Ä</div>
      <div class="leaderboard-entry">ü•à Bob ‚Äî 1320 –º–º—Ä</div>
      <div class="leaderboard-entry">ü•â Charlie ‚Äî 1280 –º–º—Ä</div>
      <div class="leaderboard-entry"><span id="profile-name-leader">–ì–æ—Å—Ç—å</span> ‚Äî <span id="user-mmr">1000</span> –º–º—Ä</div>
    </div>
  </div>

  <div id="board"></div>

  <div class="footer">
    <div class="rating">–í–∞—à —Ä–µ–π—Ç–∏–Ω–≥: <span id="mmr-display">1000</span> &nbsp;~<span id="level">5</span> <i>lvl</i></div>
    <button id="search-btn" class="search-btn">–ü–û–ò–°–ö</button>
  </div>

  <script>
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ MMR –∏ —É—Ä–æ–≤–Ω—è
    let mmr = parseInt(localStorage.getItem('mmr')) || 1000;
    document.getElementById('mmr').textContent = mmr;
    document.getElementById('mmr-display').textContent = mmr;
    document.getElementById('user-mmr').textContent = mmr;
    const level = Math.min(10, Math.floor(mmr / 250) + 1);
    document.getElementById('level').textContent = level;

    // Telegram WebApp
    const tg = window.Telegram.WebApp;
    tg.ready();

    function onTelegramAuth(user) {
      document.getElementById('profile-name').textContent = user.first_name;
      document.getElementById('profile-pic').src = user.photo_url || 'https://via.placeholder.com/32';
      document.getElementById('login-btn').style.display = 'none';
      document.getElementById('profile-name-history').textContent = user.first_name;
      document.getElementById('profile-name-leader').textContent = user.first_name;
      localStorage.setItem('user_name', user.first_name);
      localStorage.setItem('user_avatar', user.photo_url || '');
    }

    document.getElementById('login-btn').addEventListener('click', () => {
      // –í–Ω–µ Telegram: –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
      // –ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ WebApp, user —É–∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ tg.initDataUnsafe
      if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
        const user = tg.initDataUnsafe.user;
        onTelegramAuth(user);
      } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º Telegram Login Widget
        alert('–î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–Ω–∞—Ä—É–∂–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∏–¥–∂–µ—Ç.');
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à–∞—Ö–º–∞—Ç–Ω–æ–π –¥–æ—Å–∫–∏
    const board = Chessboard('board', { position: 'start', draggable: true });

    // –ü–æ–∏—Å–∫ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ (–∑–∞–≥–ª—É—à–∫–∞)
    document.getElementById('search-btn').addEventListener('click', () => {
      document.getElementById('main-container').style.display = 'none';
      document.getElementById('board').style.display = 'block';
      document.getElementById('search-btn').textContent = '–ü–æ–∏—Å–∫...';
      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–∏—Å–∫–∞ –∏ –Ω–∞—á–∞–ª–∞ –ø–∞—Ä—Ç–∏–∏
      setTimeout(() => {
        document.getElementById('search-btn').textContent = '–ù–∞—á–∞—Ç—å –ü–∞—Ä—Ç–∏—é';
      }, 2000);
    });
  </script>
</body>
</html>
